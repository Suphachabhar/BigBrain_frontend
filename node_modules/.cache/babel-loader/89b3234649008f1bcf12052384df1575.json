{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/suphachabharnigrodhananda/Desktop/6080/ass3/frontend/src/pages/play.jsx\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport propTypes from 'prop-types';\nimport Cookies from 'universal-cookie';\nimport { Redirect } from 'react-router-dom';\nimport ChromeDinoGame from 'react-chrome-dino';\n\nfunction Play({\n  changeAlert\n}) {\n  _s();\n\n  const cookies = new Cookies();\n  const [redirect, setRedirect] = React.useState('');\n  const [started, setStarted] = React.useState(false);\n  const [question, setQuestion] = React.useState('');\n  const [point, setPoint] = React.useState(0);\n  const [src, setSrc] = React.useState('');\n  const [choices, setChoices] = React.useState([]);\n  const [multiple, setMultiple] = React.useState(false);\n  const [answersSelected, selectAnswer] = React.useState([]);\n  const [time, setTime] = React.useState(0);\n  const [timer, setTimer] = React.useState(null);\n  const [playing, setPlaying] = React.useState(true);\n  const [questionResult, setResult] = React.useState(null);\n\n  const dinogame = () => /*#__PURE__*/_jsxDEV(ChromeDinoGame, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 23,\n    columnNumber: 5\n  }, this);\n\n  const endSession = () => {\n    changeAlert('warning', 'Please join a session to play.');\n    clearInterval(timer);\n    setRedirect('/join');\n  };\n\n  const getQuestion = started => {\n    fetch('http://localhost:5005/play/' + cookies.get('player') + '/question', {\n      method: 'GET',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(data => {\n      if (data.status === 200) {\n        data.json().then(result => {\n          setQuestion(result.question.description);\n          setPoint(result.question.point);\n          setSrc(result.question.src);\n          setChoices(result.question.choices);\n          setMultiple(result.question.multiple);\n          const newTime = result.question.time * 1000 - (new Date() - new Date(result.question.isoTimeLastQuestionStarted));\n          setTime(newTime);\n          setPlaying(newTime > 0);\n\n          if (newTime > 0) {\n            selectAnswer([]);\n          }\n\n          setStarted(started);\n        });\n      } else {\n        endSession();\n      }\n    });\n  };\n\n  const checkStatus = () => {\n    fetch('http://localhost:5005/play/' + cookies.get('player') + '/status', {\n      method: 'GET',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(data => {\n      if (data.status === 200) {\n        data.json().then(result => {\n          if (result.started) {\n            getQuestion(result.started);\n          }\n        });\n      } else {\n        endSession();\n      }\n    });\n  };\n\n  React.useEffect(() => {\n    if (cookies.get('player')) {\n      if (playing) {\n        clearInterval(timer);\n        setResult(null);\n        setTimer(setTimeout(() => {\n          setPlaying(false);\n        }, time));\n      } else {\n        clearTimeout(timer);\n\n        if (started) {\n          fetch('http://localhost:5005/play/' + cookies.get('player') + '/answer', {\n            method: 'GET',\n            headers: {\n              Accept: 'application/json',\n              'Content-Type': 'application/json'\n            }\n          }).then(data => {\n            if (data.status === 200) {\n              data.json().then(result => {\n                const correctAnswer = [];\n                let correct = true;\n                choices.forEach(choice => {\n                  if (result.answerIds.includes(choice.id)) {\n                    correctAnswer.push( /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: choice.choice\n                    }, choice.id, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 104,\n                      columnNumber: 40\n                    }, this));\n                    correct &= answersSelected.includes(choice.id);\n                  }\n                });\n                const getItRight = correct ? 'right' : 'wrong';\n                setResult( /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"popup\",\n                    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                      children: \"Correct answer:\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 115,\n                      columnNumber: 23\n                    }, this), correctAnswer, /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: [\"You get this question \", getItRight, \"!\"]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 117,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: \"Please wait for admin advancing to the next question.\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 118,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 112,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false));\n              });\n            } else {\n              endSession();\n            }\n          });\n        }\n\n        setTimer(setInterval(() => {\n          checkStatus();\n        }, 1000));\n      }\n    } else {\n      endSession();\n    }\n  }, [started, playing]);\n  let display = null;\n\n  if (src.startsWith('http')) {\n    display = /*#__PURE__*/_jsxDEV(\"iframe\", {\n      src: src\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 15\n    }, this);\n  } else if (src !== '') {\n    display = /*#__PURE__*/_jsxDEV(\"img\", {\n      src: src\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 15\n    }, this);\n  }\n\n  const answers = choices.map(choice => {\n    let ansClass = 'list-group-item';\n\n    if (answersSelected.includes(choice.id)) {\n      ansClass += ' selectedAnswer';\n    }\n\n    let answerClicked = null;\n\n    if (playing) {\n      answerClicked = () => {\n        const i = answersSelected.indexOf(choice.id);\n\n        if (i > -1) {\n          const newAnswers = answersSelected.slice();\n          newAnswers.splice(i, 1);\n          selectAnswer(newAnswers);\n        } else if (multiple) {\n          const newAnswers = answersSelected.slice();\n          newAnswers.push(choice.id);\n          selectAnswer(newAnswers);\n        } else {\n          selectAnswer([choice.id]);\n        }\n\n        console.log(choice.id);\n      };\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"li\", {\n      className: ansClass,\n      onClick: answerClicked,\n      children: choice.choice\n    }, choice.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }, this);\n  });\n  React.useEffect(() => {\n    fetch('http://localhost:5005/play/' + cookies.get('player') + '/answer', {\n      method: 'PUT',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        answerIds: answersSelected\n      })\n    });\n  }, [answersSelected]);\n  let numberOfAnswers = null;\n\n  if (multiple) {\n    numberOfAnswers = '(You can choose more than one answer.)';\n  } else {\n    numberOfAnswers = '(You can choose one answer only.)';\n  }\n\n  if (redirect !== '') {\n    return /*#__PURE__*/_jsxDEV(Redirect, {\n      push: true,\n      to: redirect\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }, this);\n  } else if (!started) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"The game has not started yet\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Please wait for admin to start the game...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }, this), dinogame]\n    }, void 0, true);\n  } else {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"firstsection\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: question + ' (' + point + (point === 1 ? ' point' : ' points') + ')'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 11\n        }, this), display, /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"list-group\",\n          children: answers\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 11\n        }, this), numberOfAnswers, questionResult]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }, this)\n    }, void 0, false);\n  }\n}\n\n_s(Play, \"DM4MnCz9FFrtKFnA2HYsJGzJ/14=\");\n\n_c = Play;\nPlay.propTypes = {\n  changeAlert: propTypes.func\n};\nexport default Play;\n\nvar _c;\n\n$RefreshReg$(_c, \"Play\");","map":{"version":3,"sources":["/Users/suphachabharnigrodhananda/Desktop/6080/ass3/frontend/src/pages/play.jsx"],"names":["React","propTypes","Cookies","Redirect","ChromeDinoGame","Play","changeAlert","cookies","redirect","setRedirect","useState","started","setStarted","question","setQuestion","point","setPoint","src","setSrc","choices","setChoices","multiple","setMultiple","answersSelected","selectAnswer","time","setTime","timer","setTimer","playing","setPlaying","questionResult","setResult","dinogame","endSession","clearInterval","getQuestion","fetch","get","method","headers","Accept","then","data","status","json","result","description","newTime","Date","isoTimeLastQuestionStarted","checkStatus","useEffect","setTimeout","clearTimeout","correctAnswer","correct","forEach","choice","answerIds","includes","id","push","getItRight","setInterval","display","startsWith","answers","map","ansClass","answerClicked","i","indexOf","newAnswers","slice","splice","console","log","body","JSON","stringify","numberOfAnswers","func"],"mappings":"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","sourcesContent":["import React from 'react';\nimport propTypes from 'prop-types';\nimport Cookies from 'universal-cookie';\nimport {\n  Redirect\n} from 'react-router-dom';\nimport ChromeDinoGame from 'react-chrome-dino';\nfunction Play ({ changeAlert }) {\n  const cookies = new Cookies();\n  const [redirect, setRedirect] = React.useState('');\n  const [started, setStarted] = React.useState(false);\n  const [question, setQuestion] = React.useState('');\n  const [point, setPoint] = React.useState(0);\n  const [src, setSrc] = React.useState('');\n  const [choices, setChoices] = React.useState([]);\n  const [multiple, setMultiple] = React.useState(false);\n  const [answersSelected, selectAnswer] = React.useState([]);\n  const [time, setTime] = React.useState(0);\n  const [timer, setTimer] = React.useState(null);\n  const [playing, setPlaying] = React.useState(true);\n  const [questionResult, setResult] = React.useState(null);\n  const dinogame = () => (\n    <ChromeDinoGame />\n  );\n\n  const endSession = () => {\n    changeAlert('warning', 'Please join a session to play.');\n    clearInterval(timer);\n    setRedirect('/join');\n  };\n\n  const getQuestion = (started) => {\n    fetch('http://localhost:5005/play/' + cookies.get('player') + '/question', {\n      method: 'GET',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(data => {\n      if (data.status === 200) {\n        data.json().then((result) => {\n          setQuestion(result.question.description);\n          setPoint(result.question.point);\n          setSrc(result.question.src);\n          setChoices(result.question.choices);\n          setMultiple(result.question.multiple);\n          const newTime = result.question.time * 1000 - (new Date() - new Date(result.question.isoTimeLastQuestionStarted));\n          setTime(newTime);\n          setPlaying(newTime > 0);\n          if (newTime > 0) {\n            selectAnswer([]);\n          }\n          setStarted(started);\n        });\n      } else {\n        endSession();\n      }\n    });\n  };\n  const checkStatus = () => {\n    fetch('http://localhost:5005/play/' + cookies.get('player') + '/status', {\n      method: 'GET',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(data => {\n      if (data.status === 200) {\n        data.json().then((result) => {\n          if (result.started) {\n            getQuestion(result.started);\n          }\n        });\n      } else {\n        endSession();\n      }\n    });\n  };\n\n  React.useEffect(() => {\n    if (cookies.get('player')) {\n      if (playing) {\n        clearInterval(timer);\n        setResult(null);\n        setTimer(setTimeout(() => {\n          setPlaying(false);\n        }, time));\n      } else {\n        clearTimeout(timer);\n        if (started) {\n          fetch('http://localhost:5005/play/' + cookies.get('player') + '/answer', {\n            method: 'GET',\n            headers: {\n              Accept: 'application/json',\n              'Content-Type': 'application/json'\n            }\n          }).then(data => {\n            if (data.status === 200) {\n              data.json().then((result) => {\n                const correctAnswer = [];\n                let correct = true;\n                choices.forEach((choice) => {\n                  if (result.answerIds.includes(choice.id)) {\n                    correctAnswer.push(<p key={choice.id}>{choice.choice}</p>);\n                    correct &= answersSelected.includes(choice.id);\n                  }\n                });\n\n                const getItRight = correct ? 'right' : 'wrong';\n                setResult(\n                  <>\n                    <div\n                      className='popup'\n                    >\n                      <p>Correct answer:</p>\n                      {correctAnswer}\n                      <p>You get this question {getItRight}!</p>\n                      <p>Please wait for admin advancing to the next question.</p>\n                    </div>\n                  </>\n                );\n              });\n            } else {\n              endSession();\n            }\n          });\n        }\n        setTimer(setInterval(() => {\n          checkStatus();\n        }, 1000));\n      }\n    } else {\n      endSession();\n    }\n  }, [started, playing]);\n\n  let display = null;\n  if (src.startsWith('http')) {\n    display = <iframe src={src}></iframe>;\n  } else if (src !== '') {\n    display = <img src={src}></img>;\n  }\n\n  const answers = choices.map((choice) => {\n    let ansClass = 'list-group-item';\n    if (answersSelected.includes(choice.id)) {\n      ansClass += ' selectedAnswer';\n    }\n\n    let answerClicked = null;\n    if (playing) {\n      answerClicked = () => {\n        const i = answersSelected.indexOf(choice.id);\n        if (i > -1) {\n          const newAnswers = answersSelected.slice();\n          newAnswers.splice(i, 1);\n          selectAnswer(newAnswers);\n        } else if (multiple) {\n          const newAnswers = answersSelected.slice();\n          newAnswers.push(choice.id);\n          selectAnswer(newAnswers);\n        } else {\n          selectAnswer([choice.id]);\n        }\n        console.log(choice.id);\n      };\n    }\n    return (\n      <li className={ansClass} key={choice.id} onClick={answerClicked}>\n        {choice.choice}\n      </li>\n    );\n  });\n  React.useEffect(() => {\n    fetch('http://localhost:5005/play/' + cookies.get('player') + '/answer', {\n      method: 'PUT',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        answerIds: answersSelected\n      })\n    });\n  }, [answersSelected]);\n\n  let numberOfAnswers = null;\n  if (multiple) {\n    numberOfAnswers = '(You can choose more than one answer.)';\n  } else {\n    numberOfAnswers = '(You can choose one answer only.)';\n  }\n\n  if (redirect !== '') {\n    return (\n      <Redirect push to={redirect} />\n    );\n  } else if (!started) {\n    return (\n      <>\n        <h1>The game has not started yet</h1>\n        <p>Please wait for admin to start the game...</p>\n        {dinogame}\n      </>\n    );\n  } else {\n    return (\n      <>\n        <div className='firstsection'>\n          <h1>{question + ' (' + point + ((point === 1) ? ' point' : ' points') + ')'}</h1>\n          {display}\n          <ul className='list-group'>\n            {answers}\n          </ul>\n          {numberOfAnswers}\n          {questionResult}\n        </div>\n      </>\n    );\n  }\n}\n\nPlay.propTypes = {\n  changeAlert: propTypes.func\n};\n\nexport default Play;\n"]},"metadata":{},"sourceType":"module"}